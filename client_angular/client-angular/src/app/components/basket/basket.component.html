<div class="surface-ground px-4 py-5 md:px-6 lg:px-8" dir="rtl">
    <div class="flex justify-content-between align-items-center mb-5">
        <div>
            <h1 class="text-900 font-bold text-3xl m-0">עגלת הקניות שלי</h1>
            <p class="text-600 mt-2">סיכום המתנות שבחרת להגרלה</p>
        </div>
        <p-button label="המשך בקנייה" icon="pi pi-arrow-left" [text]="true" routerLink="/gifts"></p-button>
    </div>

    @if (basketItems && basketItems.length > 0) {
        <div class="surface-card shadow-2 border-round-xl p-4">
            <p-table [value]="basketItems" styleClass="p-datatable-sm" [responsive]="true">
                <ng-template pTemplate="header">
                    <tr>
                        <th style="width: 35%">מוצר</th>
                        <th style="width: 15%">מחיר יחידה</th>
                        <th style="width: 15%">כמות כרטיסים</th>
                        <th style="width: 15%">סה"כ</th>
                        <th style="width: 20%">הסרה</th> 
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-item>
                    <tr>
                        <td>
                            <div class="flex align-items-center gap-3">
                            <img [src]="'assets/images/' + (item.gift?.imageUrl || 'default.jpg')" 
     [alt]="item.gift?.giftName"
     width="60" 
     class="shadow-1 border-round-lg" 
     (error)="$any($event.target).src='assets/images/default.jpg'"/>
                                <div class="flex flex-column">
                                    <span class="font-bold text-900">{{ item.gift?.giftName || 'טוען מוצר...' }}</span>
                                    <small class="text-500">קוד מתנה: {{ item.giftId }}</small>
                                </div>
                            </div>
                        </td>
                        <td class="text-700">
                            {{ (item.gift?.ticketPrice || 0) | currency:'ILS':'symbol':'1.0-2' }}
                        </td>
                        <td>
                            <span class="p-column-title font-bold">כמות:</span>
                            <span class="text-900 font-medium">{{ item.quantity }}</span>
                        </td>
                        <td class="font-bold text-primary text-xl">
                            {{ ((item.gift?.ticketPrice || 0) * item.quantity) | currency:'ILS':'symbol':'1.0-2' }}
                        </td>
                        <td>
                            <p-button icon="pi pi-trash" 
                                      severity="danger" 
                                      [text]="true" 
                                      (onClick)="removeItem(item.id)">
                            </p-button>
                        </td>
                    </tr>
                </ng-template>
            </p-table>

            <div class="flex flex-column align-items-end mt-5 pt-4 border-top-1 surface-border">
                <div class="mb-4 w-full md:w-5 lg:w-3 text-right">
        <label for="cc" class="block font-bold mb-2 text-700">כרטיס אשראי (16 ספרות)</label>
        <input 
            type="text" 
            id="cc"
            pInputText 
            [(ngModel)]="creditCard" 
            placeholder="0000 0000 0000 0000"
            maxlength="16"
            class="w-full p-inputtext-lg border-round-lg shadow-1"
            style="letter-spacing: 2px; text-align: center;"
        />
    </div>
                <div class="flex justify-content-between w-full md:w-5 lg:w-3 border-bottom-1 surface-border pb-3 mb-3">
                    <span class="text-xl text-700">סה"כ לתשלום:</span>
                    <span class="text-3xl font-bold text-primary">{{ totalAmount | currency:'ILS':'symbol':'1.0-2' }}</span>
                </div>
                
                <div class="flex gap-3 w-full md:w-auto">
                    <p-button label="בצע רכישה מאובטחת" 
                              icon="pi pi-lock" 
                              severity="success" 
                              size="large" 
                              (onClick)="processCheckout()" 
                              styleClass="w-full md:w-auto px-6 border-round-lg shadow-3">
                    </p-button>
                </div>
            </div>
        </div>
    } @else {
        <div class="surface-card shadow-2 border-round-xl p-8 text-center flex flex-column align-items-center">
            <div class="border-circle bg-blue-50 inline-flex align-items-center justify-content-center h-8rem w-8rem mb-4">
                <i class="pi pi-shopping-cart text-6xl text-blue-500"></i>
            </div>
            <h2 class="text-900 font-bold text-2xl mb-2">הסל שלך עדיין ריק...</h2>
            <p class="text-600 mb-5 text-xl">נראה שעדיין לא בחרת מתנות להשתתפות בהגרלה.</p>
            <p-button label="מעבר לקטלוג המתנות" 
                      icon="pi pi-shopping-bag" 
                      styleClass="p-button-raised p-button-rounded px-6" 
                      routerLink="/gifts">
            </p-button>
        </div>
    }
</div>