<div class="surface-ground px-4 py-5 md:px-6 lg:px-8 min-h-screen" dir="rtl">
  
  <div class="flex flex-column md:flex-row justify-content-between align-items-center mb-5 gap-4">
    <div>
      <h1 class="text-900 font-bold text-4xl m-0 line-height-2 letter-spacing-1">ניהול תורמים</h1>
      <div class="h-3px w-4rem bg-900 mt-2"></div>
    </div>
    <p-button (onClick)="openAddDonor()" styleClass="p-button-black shadow-4 border-round-xl">
      <div class="flex align-items-center gap-2 px-3 py-1">
        <i class="pi pi-plus-circle text-xl"></i>
        <span class="font-bold text-lg">הוספת תורם חדש</span>
      </div>
    </p-button>
  </div>
  <div class="surface-card shadow-1 border-round-xl p-4 mb-6 border-1 border-200">
    <div class="grid p-fluid align-items-center">
      <div class="col-12 md:col-4">
        <span class="p-input-icon-right">
          <i class="pi pi-user text-600"></i>
          <input type="text" pInputText [(ngModel)]="filter.name" (input)="onFilterChange()" placeholder="חפש לפי שם תורם..." class="p-inputtext-lg border-round-lg bg-50"/>
        </span>
      </div>
      <div class="col-12 md:col-4">
        <span class="p-input-icon-right">
          <i class="pi pi-envelope text-600"></i>
          <input type="text" pInputText [(ngModel)]="filter.email" (input)="onFilterChange()" placeholder="חפש לפי אימייל..." class="p-inputtext-lg border-round-lg bg-50"/>
        </span>
      </div>
      <div class="col-12 md:col-3">
        <span class="p-input-icon-right">
          <i class="pi pi-gift text-600"></i>
          <input type="text" pInputText [(ngModel)]="filter.giftName" (input)="onFilterChange()" placeholder="סינון לפי מתנה..." class="p-inputtext-lg border-round-lg bg-50"/>
        </span>
      </div>
      <div class="col-12 md:col-10">
        <button pButton icon="pi pi-filter-slash" class="p-button-text p-button-plain p-button-lg" (click)="clearFilter()"></button>
      </div>
    </div>
  </div>

  <div class="grid">
    @for (d of (donors$ | async); track d.id) {
    <div class="col-12 md:col-5 lg:col-4 p-3">
      <div class="donor-card surface-card border-round-xl p-3 flex flex-column relative border-1 border-100 shadow-1 transition-all h-full">
        
        <div class="absolute top-0 left-0 p-2 flex gap-1" style="z-index: 10;">
          <button pButton icon="pi pi-pencil" class="p-button-rounded p-button-text p-button-plain p-button-sm text-600 hover:text-900" (click)="editDonor(d)"></button>
          <button pButton icon="pi pi-trash" class="p-button-rounded p-button-text p-button-plain p-button-sm text-400 hover:text-red-500" (click)="deleteDonor(d)"></button>
        </div>

        <div class="text-center mb-3 mt-2">
          <div class="user-icon-circle">
              <i class="pi pi-user"></i>
          </div>
          <h3 class="text-900 font-bold m-0 text-lg tracking-tight">{{ d.firstName }} {{ d.lastName }}</h3>
          <span class="text-500 font-medium text-xs">{{ d.email }}</span>
        </div>

        <div class="border-top-1 border-100 pt-3 mt-auto">
          <p class="text-700 font-bold text-xs mb-2 uppercase">מתנות:</p>
          <div class="flex flex-wrap gap-1">
              @for (giftItem of d.gifts; track giftItem.id) {
                <span class="gift-badge">
                  {{ giftItem.giftName }}
                </span>
              } @empty {
                <span class="text-400 text-xs italic">אין תרומות</span>
              }
          </div>
        </div>
      </div>
    </div>
    }
  </div>
</div>

<p-dialog [(visible)]="showDonorDialog" [header]="isEditMode ? 'עדכון פרטי תורם' : 'הוספת תורם חדש'" [modal]="true" [style]="{width: '400px'}" [draggable]="false" [resizable]="false" class="custom-black-dialog" dir="rtl">
    <div class="flex flex-column gap-3 mt-3">
        <div class="field p-fluid">
            <label class="block mb-1 font-bold text-800">שם פרטי</label>
            <input type="text" pInputText [(ngModel)]="newDonor.firstName" #firstName="ngModel" required class="p-3 border-round-lg">
        </div>
        <div class="field p-fluid">
            <label class="block mb-1 font-bold text-800">שם משפחה</label>
            <input type="text" pInputText [(ngModel)]="newDonor.lastName" #lastName="ngModel" required class="p-3 border-round-lg">
        </div>
        <div class="field p-fluid">
            <label class="block mb-1 font-bold text-800">אימייל</label>
            <input type="email" pInputText [(ngModel)]="newDonor.email" #email="ngModel" required email class="p-3 border-round-lg">
        </div>
        <div class="field p-fluid">
            <label class="block mb-1 font-bold text-800">טלפון</label>
            <input type="text" pInputText [(ngModel)]="newDonor.phone" #phone="ngModel" required pattern="^[0-9\-]{8,11}$" class="p-3 border-round-lg">
        </div>
    </div>
    <ng-template pTemplate="footer">
        <div class="flex justify-content-end gap-2">
          <p-button label="ביטול" (onClick)="showDonorDialog = false" styleClass="p-button-text p-button-plain"></p-button>
          <p-button label="שמור" icon="pi pi-check" (onClick)="saveDonor()" [disabled]="firstName.invalid || lastName.invalid || email.invalid || phone.invalid" styleClass="p-button-black border-round-lg"></p-button>
        </div>
    </ng-template>
</p-dialog>